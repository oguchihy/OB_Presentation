library(jsonlite)  # Make sure to load the jsonlite library for JSON parsing

# Function to find Dropbox path on Windows
find_dropbox_path <- function() {
    # Define the path to the Dropbox info.json file
    info_json_path <- file.path(Sys.getenv("LOCALAPPDATA"), "Dropbox", "info.json")
    
    # Check if the file exists
    if (file.exists(info_json_path)) {
        # Read the JSON file
        info <- jsonlite::fromJSON(info_json_path)
        # Check for the 'personal' and 'path' fields in the JSON
        if ("personal" %in% names(info) && "path" %in% names(info$personal)) {
            return(info$personal$path)
        } else {
            stop("Dropbox personal path not found in info.json")
        }
    } else {
        stop("Dropbox info.json does not exist at the expected location.")
    }
}

# Try to set DROPBOX_PATH environment variable
try({
    dropbox_path <- find_dropbox_path()
    Sys.setenv(DROPBOX_PATH = dropbox_path)
}, silent = TRUE)
